#!/usr/bin/env bash

usage() { echo "usage: $0 [-e VAR] [-v VOLUME] -- [SCRIPT] [OPTIONS]" 1>&2; }

mounts=()
vars=()
while getopts ":hv:" opt; do
    case "${opt}" in
        e) vars+=("-${opt} ${OPTARG}") ;;
        v) mounts+=("-${opt} ${OPTARG}") ;;
        :) echo "howl: option -${OPTARG} requires an argument"; usage; exit 1 ;;
        h) usage; exit 0 ;;
        \?) echo "howl: option -${OPTARG} is unknown"; usage; exit 1 ;;
    esac
done
shift $((OPTIND -1))

module=$1; shift
options=$@

docker run --platform linux/amd64 -it jjgp/magic-packet:howl \
    ${mounts:+ "${mounts[@]}"} \
    ${vars:+ "${vars[@]}"} \
    python -m $module $options
